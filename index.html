<!doctype html>
<html lang="en" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ramadan Challenge Map</title>
  <script src="https://cdn.tailwindcss.com/3.4.17"></script>
  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;700;800&family=Amiri:wght@400;700&display=swap" rel="stylesheet">
  <style>
    .font-main { font-family: 'Baloo 2', cursive; }
    .font-arabic { font-family: 'Amiri', serif; }
    @keyframes float { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-10px); } }
    @keyframes starPop { 0% { transform: scale(0); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
    .float-animation { animation: float 3s ease-in-out infinite; }
    .star-animate { animation: starPop 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
    .current-day { border: 3px solid #fbbf24; box-shadow: 0 0 15px rgba(251, 191, 36, 0.6); }
    .locked { filter: grayscale(0.7); opacity: 0.5; cursor: not-allowed; }
    .modal-backdrop { backdrop-filter: blur(8px); }

    /* Styling untuk hilangkan scroll bar tapi tetap boleh scroll */
html, body {
  margin: 0;
  padding: 0;
  height: 100dvh; /* Dynamic height untuk phone */
  overflow: hidden; /* Sembunyikan scroll bar utama */
}

#app-container {
  height: 100%;
  overflow-y: auto; /* Benarkan scroll di dalam container */
  -ms-overflow-style: none;  /* IE and Edge */
  scrollbar-width: none;  /* Firefox */
}

#app-container::-webkit-scrollbar {
  display: none; /* Sembunyi terus untuk Chrome, Safari & Opera */
}

/* Tambahan styling untuk butang muzik */
.music-btn {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background: rgba(30, 27, 75, 0.8);
  border: 1px solid #fbbf24;
  padding: 12px;
  border-radius: 50%;
  z-index: 100;
  cursor: pointer;
  box-shadow: 0 4px 10px rgba(0,0,0,0.3);
  transition: all 0.3s ease;
}
.music-btn:hover { transform: scale(1.1); }
  </style>
 </head>
 <body class="h-full font-main text-white" style="background: linear-gradient(135deg, #1e1b4b 0%, #312e81 100%);">
  
  <div id="app-container" class="max-w-4xl mx-auto h-full p-4 overflow-y-auto">
   <header class="text-center py-6 relative">
    <div class="absolute top-0 right-0 bg-indigo-900/50 rounded-full px-4 py-2 border border-yellow-400/30">
        <span class="text-xl">‚≠ê</span> <span id="total-stars" class="text-yellow-300 font-bold">0</span>
    </div>
    <div class="text-6xl float-animation mb-2">üåô</div>
    <h1 class="text-3xl md:text-4xl font-extrabold text-yellow-300 tracking-wide">My Ramadan Journey</h1>
    <p class="text-indigo-200 mt-1">Welcome, <span class="text-yellow-200">Little Mukmin</span>! ‚ú®</p>
   </header>

   <div class="mb-8">
    <div class="bg-indigo-950 rounded-full h-4 w-full overflow-hidden border border-indigo-800">
     <div id="progress-bar" class="bg-gradient-to-r from-yellow-400 to-amber-500 h-full transition-all duration-700" style="width: 0%"></div>
    </div>
    <p class="text-center text-xs text-indigo-300 mt-2 uppercase tracking-widest"><span id="days-completed">0</span> / 30 Days Journey</p>
   </div>

   <div id="map-grid" class="grid grid-cols-5 md:grid-cols-6 gap-3 pb-20"></div>

   <div id="day-modal" class="fixed inset-0 bg-black/80 modal-backdrop hidden items-center justify-center z-50 p-4">
    <div class="bg-indigo-900 border-2 border-yellow-400/50 p-6 rounded-3xl w-full max-w-sm text-center shadow-2xl">
     <div id="modal-emoji" class="text-6xl mb-4">üåô</div>
     <h2 id="modal-title" class="text-2xl font-bold text-yellow-300 mb-2">Day Challenge</h2>
     <p id="modal-task" class="text-indigo-100 mb-6 text-lg"></p>
     <div id="modal-footer"></div>
     <button onclick="closeModals()" class="mt-4 text-indigo-400 text-sm underline">Maybe later</button>
    </div>
   </div>

   <div id="fasting-modal" class="fixed inset-0 bg-black/80 modal-backdrop hidden items-center justify-center z-50 p-4">
    <div class="bg-emerald-900 border-2 border-emerald-400/50 p-6 rounded-3xl w-full max-w-sm text-center">
     <div class="text-6xl mb-4">üçΩÔ∏è</div>
     <h2 class="text-2xl font-bold text-emerald-300 mb-2">Fasting Check</h2>
     <p class="text-emerald-100 mb-6">MashaAllah! Did you fast today?</p>
     <div class="grid grid-cols-1 gap-3">
        <button onclick="completeDay(true)" class="bg-emerald-500 hover:bg-emerald-400 py-4 rounded-2xl font-bold text-lg">Yes, Alhamdulillah! ‚ú®</button>
        <button onclick="completeDay(false)" class="bg-amber-500 hover:bg-amber-400 py-4 rounded-2xl font-bold text-lg">Not today üí™</button>
     </div>
    </div>
   </div>

   <div id="reminder-modal" class="fixed inset-0 bg-black/80 modal-backdrop hidden items-center justify-center z-50 p-4">
    <div class="bg-rose-900 border-2 border-rose-400/50 p-6 rounded-3xl w-full max-w-sm text-center">
     <div class="text-6xl mb-4">ü§≤</div>
     <h2 class="text-2xl font-bold text-rose-300 mb-2">Gentle Reminder</h2>
     <p id="reminder-text" class="text-rose-100 mb-6"></p>
     <button onclick="openFastingFromReminder()" class="w-full bg-rose-500 py-3 rounded-xl font-bold">I understand! üåü</button>
    </div>
   </div>

   <div id="celebration-modal" class="fixed inset-0 bg-black/80 modal-backdrop hidden items-center justify-center z-50 p-4">
    <div class="bg-indigo-800 border-4 border-yellow-400 p-8 rounded-3xl w-full max-w-md text-center shadow-[0_0_50px_rgba(251,191,36,0.4)]">
     <div id="celeb-icon" class="text-7xl mb-4 star-animate">‚≠ê</div>
     <h2 id="celeb-title" class="text-3xl font-bold text-yellow-300 mb-2">Excellent!</h2>
     <p id="celeb-msg" class="text-indigo-100 mb-6 text-lg"></p>
     <div id="celeb-note" class="bg-indigo-950/50 p-4 rounded-2xl text-yellow-200 text-sm mb-6 italic border border-yellow-400/20"></div>
     <button onclick="closeModals()" class="w-full bg-yellow-400 text-indigo-900 py-4 rounded-2xl font-extrabold text-xl shadow-lg">CONTINUE JOURNEY</button>
    </div>
   </div>

  </div>

  <script>

    function toggleMusic() {
    const music = document.getElementById('bgMusic');
    const icon = document.getElementById('musicIcon');
    
    if (music.paused) {
        music.play();
        icon.innerText = 'üîä';
        document.getElementById('musicBtn').style.borderColor = '#fbbf24';
    } else {
        music.pause();
        icon.innerText = 'üîá';
        document.getElementById('musicBtn').style.borderColor = '#4b5563';
    }
}

// Tambahan: Muzik akan mula bila user klik mana-mana (sebab browser block autoplay)
document.addEventListener('click', function() {
    const music = document.getElementById('bgMusic');
}, { once: true });

    // Audio Context for Sound Effects
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function playSound(type) {
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain); gain.connect(audioCtx.destination);
        if(type === 'star') {
            osc.frequency.setValueAtTime(800, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(1200, audioCtx.currentTime + 0.1);
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
        } else {
            osc.frequency.setValueAtTime(400, audioCtx.currentTime);
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.2);
        }
        osc.start(); osc.stop(audioCtx.currentTime + 0.3);
    }

    const challenges = [
      { emoji: 'üìø', title: 'Dhikr Time', task: 'Say "SubhanAllah" 33 times after each prayer today' },
      { emoji: 'üìñ', title: 'Quran Reader', task: 'Read or listen to 1 page of Quran' },
      { emoji: 'üíù', title: 'Kindness Star', task: 'Do 3 kind things for your family members' },
      { emoji: 'ü§≤', title: 'Dua Master', task: 'Learn a new dua and recite it 5 times' },
      { emoji: 'üßπ', title: 'Helper Hero', task: 'Help clean up after Iftar without being asked' },
      { emoji: 'üòä', title: 'Smile Champion', task: 'Give 10 genuine smiles to people today' },
      { emoji: 'üçΩÔ∏è', title: 'Grateful Heart', task: 'Say "Alhamdulillah" before and after every meal' },
      { emoji: 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶', title: 'Family Time', task: 'Spend 15 minutes talking with family about Ramadan' },
      { emoji: 'üåô', title: 'Night Prayer', task: 'Pray 2 extra rakaat before sleeping' },
      { emoji: 'üíß', title: 'Water Saver', task: 'Use water carefully when making wudu' },
      { emoji: 'üìö', title: 'Story Time', task: 'Learn about one Prophet story today' },
      { emoji: 'üéÅ', title: 'Sharing Joy', task: 'Share your food or toys with someone' },
      { emoji: 'ü§´', title: 'Patience Practice', task: 'Stay calm and patient all day, no complaining!' },
      { emoji: 'üíå', title: 'Love Notes', task: 'Write or draw something nice for your parents' },
      { emoji: 'üïå', title: 'Masjid Love', task: 'Pray at least one prayer at the masjid or in jamaah' },
      { emoji: 'üåü', title: 'Good Words', task: 'Only say positive and kind words today' },
      { emoji: 'üìø', title: 'Tasbih Counter', task: 'Complete 100 "Astaghfirullah" throughout the day' },
      { emoji: 'üçé', title: 'Healthy Iftar', task: 'Eat fruits and vegetables at Iftar' },
      { emoji: 'üë¥', title: 'Elder Respect', task: 'Call or visit an elderly family member' },
      { emoji: 'üß∏', title: 'Toy Donation', task: 'Pick one toy to donate to a child in need' },
      { emoji: 'üìñ', title: 'Surah Memorizer', task: 'Memorize or revise a short surah' },
      { emoji: 'ü§ù', title: 'Friend Maker', task: 'Be extra nice to a friend or sibling' },
      { emoji: 'üåÖ', title: 'Suhoor Hero', task: 'Wake up for Suhoor without complaints' },
      { emoji: 'üí≠', title: 'Reflection Time', task: 'Think about 5 things youre grateful for' },
      { emoji: 'üé®', title: 'Islamic Art', task: 'Draw or create something about Ramadan or Islam' },
      { emoji: 'üìø', title: 'Salawat Special', task: 'Send 50 salawat upon Prophet Muhammad Ô∑∫' },
      { emoji: 'üßò', title: 'Calm Mind', task: 'Sit quietly for 5 minutes thinking about Allah' },
      { emoji: 'üí∞', title: 'Sadaqah Day', task: 'Put money in a charity box or help collect for poor' },
      { emoji: 'üåô', title: 'Laylatul Qadr', task: 'Make extra dua and pray extra tonight' },
      { emoji: 'üéâ', title: 'Eid Prep', task: 'Help prepare for Eid and thank Allah for Ramadan!' }
    ];

    const reminders = ['Avoid getting angry today!', 'Remember to speak only the truth.', 'Be extra patient with siblings.'];

    let progressData = JSON.parse(localStorage.getItem('ramadan_data_v2')) || [];
    let activeDay = null;

    function render() {
      const grid = document.getElementById('map-grid');
      grid.innerHTML = '';
      const totalStars = progressData.reduce((s, d) => s + d.stars, 0);
      const completed = progressData.length;
      const current = Math.min(completed + 1, 30);

      document.getElementById('total-stars').textContent = totalStars;
      document.getElementById('days-completed').textContent = completed;
      document.getElementById('progress-bar').style.width = `${(completed / 30) * 100}%`;

      for (let i = 1; i <= 30; i++) {
        const dData = progressData.find(d => d.day === i);
        const locked = i > current;
        const card = document.createElement('div');
        card.className = `day-card p-4 rounded-2xl text-center relative ${locked ? 'locked bg-indigo-950' : (dData ? 'bg-emerald-600' : 'bg-indigo-600')} ${i === current && !dData ? 'current-day' : ''}`;
        card.innerHTML = `<div class="text-3xl mb-1">${locked ? 'üîí' : challenges[i-1].emoji}</div><div class="text-[10px] font-bold opacity-70">DAY ${i}</div>${dData ? '<div class="absolute -top-2 -right-1 text-xl">‚≠ê</div>' : ''}`;
        if(!locked) card.onclick = () => openDay(i);
        grid.appendChild(card);
      }
    }

    function openDay(day) {
      activeDay = day;
      const dData = progressData.find(d => d.day === day);
      document.getElementById('modal-day-num')?.remove(); // cleanup
      document.getElementById('modal-emoji').textContent = challenges[day-1].emoji;
      document.getElementById('modal-title').textContent = challenges[day-1].title;
      document.getElementById('modal-task').textContent = challenges[day-1].task;
      
      const footer = document.getElementById('modal-footer');
      if (dData) {
        footer.innerHTML = `<p class="text-emerald-300 font-bold">Day Completed! You earned ${dData.stars} stars.</p>`;
      } else {
        footer.innerHTML = `<button onclick="checkReminder(${day})" class="w-full bg-yellow-400 text-indigo-900 py-3 rounded-xl font-bold">I DID IT!</button>`;
      }
      document.getElementById('day-modal').classList.replace('hidden', 'flex');
    }

    function checkReminder(day) {
      playSound('alert');
      document.getElementById('day-modal').classList.replace('flex', 'hidden');
      if (day % 3 === 0) {
        document.getElementById('reminder-text').textContent = reminders[Math.floor(Math.random() * reminders.length)];
        document.getElementById('reminder-modal').classList.replace('hidden', 'flex');
      } else {
        openFasting();
      }
    }

    function openFastingFromReminder() {
      document.getElementById('reminder-modal').classList.replace('flex', 'hidden');
      openFasting();
    }

    function openFasting() {
      document.getElementById('fasting-modal').classList.replace('hidden', 'flex');
    }

    function completeDay(fasted) {
      const stars = fasted ? 2 : 1;
      progressData.push({ day: activeDay, stars: stars });
      localStorage.setItem('ramadan_data_v2', JSON.stringify(progressData));
      
      document.getElementById('fasting-modal').classList.replace('flex', 'hidden');
      
      // Setup Celebration
      const isFinalDay = activeDay === 30;
      if (isFinalDay) {
        document.getElementById('celeb-icon').textContent = 'üéä';
        document.getElementById('celeb-title').textContent = 'Eid Mubarak!';
        document.getElementById('celeb-msg').textContent = 'MashaAllah! You have completed the full 30 days of Ramadan! We are so proud of you.';
        document.getElementById('celeb-note').textContent = 'May Allah reward your efforts. We hope to see you again next Ramadan, Little Muslim! ‚ù§Ô∏è';
      } else {
        document.getElementById('celeb-icon').textContent = '‚≠ê';
        document.getElementById('celeb-title').textContent = 'Great Job!';
        document.getElementById('celeb-msg').textContent = `You earned ${stars} stars for Day ${activeDay}!`;
        document.getElementById('celeb-note').textContent = 'üí° Tip: Visit me again during Suhoor or after Tarawih tonight to see your challenge for tomorrow!';
      }
      
      playSound('star');
      document.getElementById('celebration-modal').classList.replace('hidden', 'flex');
      render();
    }

    function closeModals() {
      document.querySelectorAll('.modal-backdrop').forEach(m => m.classList.replace('flex', 'hidden'));
    }

    render();
  </script>
  <audio id="bgMusic" loop>
  <source src="lagu-ramadan.mp3" type="audio/mpeg">
</audio>

<button onclick="toggleMusic()" class="music-btn" id="musicBtn">
  <span id="musicIcon" style="font-size: 20px;">üîá</span>
</button>
 </body>
</html>

